<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procedimentos de OPMEs disponíveis no SIGTAP/SUS</title>
    <!-- Inclui o Tailwind CSS para estilização -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ... [SEUS ESTILOS, TODOS OK] ... */
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto bg-white p-6 rounded-xl shadow-lg">
        <!-- [RESTANTE DO SEU HTML, IGUAL] -->
        <!-- Contêiner para a Logo e o Título -->
        <div class="header-container">
            <img src="/content/logoofort.png" alt="Logo da Oficina Ortopédica da Paraíba" class="logo">
            <h1 class="text-3xl font-bold text-gray-800 header-title">Procedimentos de OPMEs disponíveis na Oficina Ortopédica da Paraíba</h1>
        </div>
        <!-- ... [RESTANTE DO SEU HTML] ... -->
        <div class="footer-text">
            Criado por: Maria Eduarda Camilo Damião (Atualização 08/2025)
        </div>
    </div>
    <script>
        let data = null; // Variável para armazenar os dados JSON carregados
        let filteredData = null;
        let currentPage = 1;
        const rowsPerPage = 20;
        let currentSortColumn = 'CATEGORIA';
        let currentSortOrder = 'asc';
        const columnFilters = {};

        function displayData(dataToDisplay) {
            const tableBody = document.getElementById('data-table-body');
            tableBody.innerHTML = '';
            if (!dataToDisplay || dataToDisplay.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4">Nenhum dado encontrado.</td></tr>';
                return;
            }
            dataToDisplay.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${item.CATEGORIA || ''}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${item.PROCEDIMENTO || ''}</td>
                    <td class="px-6 py-4">${item.DESCRIÇÃO || ''}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${item['IDADE MÍNIMA'] || ''}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${item['IDADE MÁXIMA'] || ''}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${item['QUANTIDADE MÁXIMA'] || ''}</td>
                    <td class="px-6 py-4">${item.CIDS || ''}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        function updatePaginationButtonStates(totalPages) {
            const prevButton = document.querySelector('.pagination button:first-child');
            const nextButton = document.querySelector('.pagination button:last-child');
            const pageButtons = document.querySelectorAll('.pagination .page-number');
            if (prevButton) prevButton.disabled = currentPage === 1;
            if (nextButton) nextButton.disabled = currentPage === totalPages;
            pageButtons.forEach(button => {
                button.classList.remove('active');
                if (parseInt(button.textContent) === currentPage) {
                    button.classList.add('active');
                }
            });
        }
        function setupPagination(dataArray) {
            const paginationControls = document.getElementById('pagination-controls');
            paginationControls.innerHTML = '';
            const totalPages = Math.ceil(dataArray.length / rowsPerPage);
            if (totalPages <= 1) return;
            const prevButton = document.createElement('button');
            prevButton.textContent = 'Anterior';
            prevButton.disabled = currentPage === 1;
            prevButton.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderPage(dataArray);
                }
            });
            paginationControls.appendChild(prevButton);
            const maxPageButtons = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxPageButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxPageButtons - 1);
            if (endPage - startPage + 1 < maxPageButtons) {
                startPage = Math.max(1, endPage - maxPageButtons + 1);
            }
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.classList.add('page-number');
                if (i === currentPage) {
                    pageButton.classList.add('active');
                }
                pageButton.addEventListener('click', () => {
                    currentPage = i;
                    renderPage(dataArray);
                });
                paginationControls.appendChild(pageButton);
            }
            const nextButton = document.createElement('button');
            nextButton.textContent = 'Próxima';
            nextButton.disabled = currentPage === totalPages;
            nextButton.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderPage(dataArray);
                }
            });
            paginationControls.appendChild(nextButton);
            updatePaginationButtonStates(totalPages);
        }
        function renderPage(dataArray) {
            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const paginatedData = dataArray.slice(start, end);
            displayData(paginatedData);
            setupPagination(dataArray);
        }
        function sortData(dataArray, column, order) {
            dataArray.sort((a, b) => {
                const valA = a[column];
                const valB = b[column];
                const strA = (valA === null || valA === undefined) ? '' : String(valA);
                const strB = (valB === null || valB === undefined) ? '' : String(valB);
                const numA = parseFloat(strA.replace(',', '.'));
                const numB = parseFloat(strB.replace(',', '.'));
                let comparison = 0;
                if (!isNaN(numA) && !isNaN(numB)) {
                    if (numA < numB) comparison = -1;
                    else if (numA > numB) comparison = 1;
                } else {
                    comparison = strA.localeCompare(strB, 'pt-BR', { sensitivity: 'base' });
                }
                if (order === 'desc') return comparison * -1;
                return comparison;
            });
        }
        function applyFiltersAndSort() {
            if (!data) return;
            let currentFilteredData = [...data];
            const columnFilterKeys = Object.keys(columnFilters);
            if (columnFilterKeys.length > 0) {
                currentFilteredData = currentFilteredData.filter(item => {
                    let match = true;
                    for (const col of columnFilterKeys) {
                        const filterTerm = columnFilters[col].toLowerCase();
                        if (filterTerm) {
                            const itemValue = item[col] ? String(item[col]).toLowerCase() : '';
                            if (!itemValue.includes(filterTerm)) {
                                match = false;
                                break;
                            }
                        }
                    }
                    return match;
                });
            }
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            if (searchTerm) {
                currentFilteredData = currentFilteredData.filter(item => {
                    const categoria = item.CATEGORIA ? String(item.CATEGORIA).toLowerCase() : '';
                    const procedimento = item.PROCEDIMENTO ? String(item.PROCEDIMENTO).toLowerCase() : '';
                    const descricao = item.DESCRIÇÃO ? String(item.DESCRIÇÃO).toLowerCase() : '';
                    const cids = item.CIDS ? String(item.CIDS).toLowerCase() : '';
                    return (
                        categoria.includes(searchTerm) ||
                        procedimento.includes(searchTerm) ||
                        descricao.includes(searchTerm) ||
                        cids.includes(searchTerm)
                    );
                });
            }
            filteredData = currentFilteredData;
            if (currentSortColumn) {
                sortData(filteredData, currentSortColumn, currentSortOrder);
            }
            currentPage = 1;
            setupPagination(filteredData);
            renderPage(filteredData);
        }
        function addSortListeners() {
            const headers = document.querySelectorAll('th[data-col]');
            headers.forEach(header => {
                const column = header.getAttribute('data-col');
                header.addEventListener('click', () => {
                    if (currentSortColumn === column) {
                        currentSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc';
                    } else {
                        currentSortColumn = column;
                        currentSortOrder = 'asc';
                    }
                    applyFiltersAndSort();
                });
            });
        }
        function addColumnFilterListeners() {
            const filterInputs = document.querySelectorAll('.column-filter-input');
            filterInputs.forEach(input => {
                const column = input.getAttribute('data-col');
                if (column) {
                    input.addEventListener('input', () => {
                        columnFilters[column] = input.value;
                        applyFiltersAndSort();
                    });
                }
            });
        }
        document.getElementById('search-input').addEventListener('input', applyFiltersAndSort);

        // Função para carregar o JSON do arquivo externo
        async function loadData() {
            try {
                const response = await fetch('dados.json');
                if (!response.ok) throw new Error('Erro ao carregar o arquivo JSON: ' + response.statusText);
                data = await response.json();
                addSortListeners();
                addColumnFilterListeners();
                applyFiltersAndSort();
            } catch (error) {
                console.error("Erro ao carregar ou analisar dados:", error);
                document.getElementById('data-table-body').innerHTML = '<tr><td colspan="7" class="text-center py-4">Erro ao carregar dados.</td></tr>';
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
        });
    </script>
</body>
</html>
